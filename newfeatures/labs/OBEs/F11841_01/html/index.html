<!DOCTYPE html>
<html lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <!-- Part number: F11841-01 -->
    <!-- Published date: November 2018 -->
    <!-- See this link for directions on getting a part number: https://confluence.oraclecorp.com/confluence/display/DLPP/Archive+an+OBE -->
    <!-- Template date: October 15, 2018 -->
    <title>Duplicating CDBs Using DBCA in Silent Mode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="robots" content="INDEX, FOLLOW">
    <meta name="description" content="Learn how to duplicate CDBs using DBCA in silent mode.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/obe-lite.css">
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.js"></script>
    <script src="js/jquery.tocify.jd.js"></script>
    <script src="js/leftnav.js"></script>
  </head>
  <body>
    <header>
      <div class="w1024" style="min-height:55px; display:block;"> <a href="https://docs.oracle.com"
          class="oracle-logo"> <img src="./img/oracle_doc_logo.png" alt="Oracle Documentation"
            style="max-width: none;" height="22" width="236"></a> </div>
    </header>
    <!--end header-->
    <div id="content">
      <h1>Duplicating CDBs Using DBCA in Silent Mode</h1>
      <div class="w1024" style="clear:both; position:relative; margin-top:40px;">
        <div class="navbackwide border-right"><!-- --></div>
        <div id="shownav" title="Show Navigation" tabindex="0"><span class="fa fa-list"></span></div>
        <div id="sidebar"><!-- -->
          <div class="left-nav-tut"><!-- -->
            <div id="hidenavw" title="Hide Navigation" tabindex="0"><span class="fa fa-close"></span></div>
            <div id="navbar" class="left-nav-w"><!-- -->
              <div id="toc" class="tocify"><!-- --></div>
            </div>
          </div>
        </div>
        <div id="bookContainer">
          <article>
            <section>
              <h2><img src="./img/32_begin.png" alt="section 0" class="num_circ"
                  height="32" width="32"> Before You Begin</h2>
              <p>This 15-minute tutorial shows you how to use Database
                Configuration Assistant (DBCA) to duplicate a container database
                (CDB). </p>
              <h3>Background</h3>
              <p>In Oracle Database 18c, duplicating a CDB requires several
                commands to be executed.</p>
              <h3>What Do You Need?</h3>
              <ul>
                <li>Oracle Database 19c installed</li>
                <li>A CDB: <code> ORCL </code>with <code> PDB1</code> in
                  archivelog mode.&nbsp;</li>
                <li><code>HR </code> schema installed in <code> PDB1 </code>
                  as an example of application tables. If you want to use the <code>
                    HR.EMPLOYEES </code> table, use the <a href="files/hr.sql"
                    target="_blank"> hr.sql. </a> Download the SQL script to
                  the labs directory created on your server <code>
                    /home/oracle/labs. </code> In the script, update the
                  password of the user connected to the database.</li>
              </ul>
            </section>
            <!-- ========================================================================================================================= -->
            <section>
              <hr>
              <h2 id="section_2" role="button" style="text-align: left;"><img src="./img/32_1.png"
                  alt="section 1" class="num_circ" height="32" width="32">Check
                the Existence of Application Data in the CDB</h2>
              <ol>
                <li>Log in to <code> PDB1 </code> in <code> ORCL </code> as
                  <code> SYSTEM</code>.
                  <pre><code>sqlplus system@PDB1<br>Enter password: <em>password</em>
</code></pre></li>
                <li>Use the <a href="files/hr.sql" target="_blank"> hr.sql </a>
                  script to create the <code>HR </code> user and <code>EMPLOYEES</code>
                  table in <code>PDB1</code>.
                  <pre><code><code>@/home/oracle/labs/hr.sql</code>
</code></pre></li>
                <li>Verify that <code>PDB1 </code> contains the <code>HR.EMPLOYEES
                    </code>table.
                  <pre><code>SELECT count(*) FROM hr.employees;

COUNT(*)
----------
       107
</code></pre></li>
                <li>Quit the session.
                  <pre><code>EXIT</code></pre>
                </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_2" role="button" style="text-align: left;"><img src="./img/32_2.png"
                  alt="section 2" class="num_circ" height="32" width="32">Use
                DBCA to Duplicate a CDB</h2>
              <p>In this section, you use DBCA in silent mode to duplicate <code>
                  ORCL </code> as <code> CDB19 </code>.</p>
              <ol>
                <li>Launch DBCA in silent mode to duplicate <code>ORCL</code>
                  as <code>CDB19</code>. Update the hostname by your server
                  name in the command. <code>SI</code> means Single Instance.
                  <pre><code>dbca -silent -createDuplicateDB -gdbName CDB19 -sid CDB19 -primaryDBConnectionString <em>hostname</em>:1521/ORCL -databaseConfigType SI -initParams db_unique_name=CDB19 -sysPassword <em>password</em> -datafileDestination /u02/app/oracle/oradata 
</code></pre>
                  <pre><code>Prepare for db operation 22% complete
Listener config step 44% complete
Auxiliary instance creation 67% complete
RMAN duplicate 89% complete
Post duplicate database operations 100% complete
Look at the log file "/u01/app/oracle/cfgtoollogs/dbca/CDB19/CDB19.log" for further details.
</code></pre> </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_3" role="button" style="text-align: left;"><img src="./img/32_3.png"
                  alt="section 3" class="num_circ" height="32" width="32">Check
                that the CDB Is Duplicated</h2>
              <ol>
                <li>Connect to <code>CDB19</code> as <code>SYS</code>.
                  <pre><code>sqlplus sys@CDB19 AS SYSDBA
Enter password: <em>password</em></code></pre>
                  <pre><code>SHOW PDBS<br><br>    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 PDB1                           READ WRITE NO<br></code></pre>
                </li>
                <li>Check that <code>PDB1 </code> contains the <code>HR.EMPLOYEES
                    </code> table as in <code>PDB1</code> of <code>ORCL</code>.
                  <pre><code>CONNECT hr@PDB1
Enter password: <em>password</em></code></pre>
                  <pre><code>SELECT count(*) FROM employees;<br><br>  COUNT(*)
----------
       107<br></code></pre>
                </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_4" role="button" style="text-align: left;"><img src="./img/32_4.png"
                  alt="section 4" class="num_circ" height="32" width="32">Use
                DBCA to Duplicate a CDB with OMF</h2>
              <p>In this section, you use DBCA in silent mode to duplicate <code>ORCL</code>
                as <code>CDBOMF19</code> with OMF files.</p>
              <ol>
                <li>Launch DBCA in silent mode to duplicate <code>ORCL</code>
                  as <code>CDBOMF19</code>. Update the hostname by your server
                  name in the command.
                  <pre><code>dbca -silent -createDuplicateDB -gdbName CDBOMF19 -sid CDBOMF19 -primaryDBConnectionString <em>hostname</em>:1521/ORCL -databaseConfigType SI -initParams db_unique_name=CDBOMF19 -sysPassword <em>password</em> -datafileDestination /u02/app/oracle/oradata –useOMF=TRUE 
</code></pre>
                  <pre><code>Prepare for db operation 22% complete
Listener config step 44% complete
Auxiliary instance creation 67% complete
RMAN duplicate 89% complete
Post duplicate database operations 100% complete
Look at the log file "/u01/app/oracle/cfgtoollogs/dbca/CDBOMF19/CDBOMF19.log" for further details.
</code></pre> </li>
                <li>Connect to <code>CDBOMF19</code> as <code>SYS</code>.
                  <pre><code>sqlplus sys@CDBOMF19 AS SYSDBA
Enter password: <em>password</em></code></pre>
                  <pre><code>COL name FORMAT A78
SELECT name FROM v$datafile;</code></pre>
                  <pre><code>NAME
--------------------------------------------------------------------
/u02/app/oracle/oradata/CDBOMF19/system01.dbf
...
/u02/app/oracle/oradata/CDBOMF19/PDB1/system01.dbf
/u02/app/oracle/oradata/CDBOMF19/PDB1/sysaux01.dbf
/u02/app/oracle/oradata/CDBOMF19/PDB1/undotbs01.dbf<br>...
</code></pre> </li>
                <li>Quit the session.<br>
                  <pre><code>EXIT<br></code></pre>
                </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_5" role="button" style="text-align: left;"><img src="./img/32_5.png"
                  alt="section 5" class="num_circ" height="32" width="32">Clean
                Up the CDBs Duplicated</h2>
              <ol>
                <li>Use DBCA to delete <code>CDB19</code>.
                  <pre><code>$ORACLE_HOME/bin/dbca -silent -deleteDatabase -sourceDB CDB19 -sid CDB19 -sysPassword <em>password</em></code></pre>
                </li>
                <li>Use DBCA to delete <code>CDBOMF19</code>.
                  <pre><code>$ORACLE_HOME/bin/dbca -silent -deleteDatabase -sourceDB CDBOMF19 -sid CDBOMF19 -sysPassword <em>password</em></code></pre>
                </li>
              </ol>
            </section>
          </article>
          <code> <code> </code></code></div>
        <code> <code> <code> <br class="clearfloat">
            </code></code></code></div>
      <code> <code> </code></code></div>
    <code> <code> <code>
          <!--close main-->
          <!--end content-->
          <div class="footer-container ">
            <div style="max-width: 994px; padding:10px 0 0 17px;">
              <footer class="footer-list">
                <ul>
                  <li> <a href="https://www.oracle.com/corporate/index.html" target="_blank">About
                      Oracle</a> </li>
                  <li> <a href="https://www.oracle.com/us/corporate/contact/index.html"
                      target="_blank">Contact Us</a> </li>
                  <li> <a href="https://www.oracle.com/us/legal/index.html" target="_blank">Legal
                      Notices</a> </li>
                  <li> <a href="https://www.oracle.com/us/legal/terms/index.html"
                      target="_blank">Terms of Use</a> </li>
                  <li> <a href="https://www.oracle.com/us/legal/privacy/index.html"
                      target="_blank">Your Privacy Rights</a> </li>
                  <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=cpyr&amp;id=en">Copyright
                      © 2018, Oracle and/or its affiliates. All rights reserved.</a></li>
                </ul>
              </footer>
            </div>
            <script type="text/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
          </div>
        </code> </code> </code>
  </body>
</html>
